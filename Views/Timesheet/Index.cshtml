@model EffectiveWebProg.ViewModels.TimesheetViewModel

@{
    ViewData["Title"] = "Timesheet";
    var startOfWeek = Model.CurrentDate.AddDays(-(int)Model.CurrentDate.DayOfWeek);
}

<div class="container">
    <div class="nav">
        <h2 id="monthYear">@Model.CurrentDate.ToString("MMMM yyyy")</h2>
        <div class="nav-buttons">
            <a asp-action="Index" asp-route-date="@Model.CurrentDate.AddDays(-7).ToString("yyyy-MM-dd")" class="btn btn-primary">&lt;</a>
            <a asp-action="Index" class="btn btn-primary">Today</a>
            <a asp-action="Index" asp-route-date="@Model.CurrentDate.AddDays(7).ToString("yyyy-MM-dd")" class="btn btn-primary">&gt;</a>
        </div>
    </div>
</div>

<table class="table">
    <thead>
        <tr>
            @for (var day = 0; day < 7; day++)
            {
                <th>@startOfWeek.AddDays(day).ToString("dddd")</th>
            }
        </tr>
    </thead>
    <tbody>
        <tr>
            @for (var day = 0; day < 7; day++)
            {
                var currentDay = startOfWeek.AddDays(day);
                <td>
                    <div class="day-box" data-date="@currentDay.ToString("yyyy-MM-dd")">
                        <span>@currentDay.ToString("MMM d")</span>
                        <div class="plus-sign" onclick="showShiftForm(this, '@currentDay.ToString("yyyy-MM-dd")')" title="Add Shift">
                            <i class="fas fa-plus-circle"></i>
                        </div>
                        <ul>
                            @foreach (var timesheet in Model.Timesheets.Where(t => t.Day.Date == currentDay.Date))
                            {
                                <li onclick="showEditShiftForm('@timesheet.SheetID')">
                                    @timesheet.Employees.EmployeeName - @timesheet.ShiftType
                                </li>
                            }
                        </ul>
                    </div>
                </td>
            }
        </tr>
    </tbody>
</table>

<!-- Add Shift Modal -->
<div id="shiftFormModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <form id="shiftForm">
            <div class="form-group">
                <label for="shiftDate">Date</label>
                <input type="date" id="shiftDate" name="Day" class="form-control" required />
            </div>
            <div class="form-group">
                <label for="employeeId">Employee Name</label>
                <select id="employeeId" name="EmployeeID" class="form-control" required>
                    <option value="">Select an employee</option>
                    @foreach (var employee in Model.Employees)
                    {
                        <option value="@employee.EmployeeID">@employee.EmployeeName</option>
                    }
                </select>
            </div>
            <div class="form-group">
                <label for="shiftType">Shift</label>
                <select id="shiftType" name="ShiftType" class="form-control" required onchange="updateShiftTimes()">
                    <option value="">Select shift</option>
                    <option value="AM">Morning Shift (10:30 AM to 6:30 PM)</option>
                    <option value="PM">Afternoon Shift (3:00 PM to 11:00 PM)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="startTime">Start Time</label>
                <input type="time" id="startTime" name="StartTime" class="form-control" required />
            </div>
            <div class="form-group">
                <label for="endTime">End Time</label>
                <input type="time" id="endTime" name="EndTime" class="form-control" required />
            </div>
            <button type="submit" class="btn btn-primary">Save</button>
        </form>
    </div>
</div>

<!-- Edit Shift Modal -->
<div id="editShiftFormModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <form id="editShiftForm">
            <input type="hidden" id="editShiftId" name="SheetID" />
            <div class="form-group">
                <label for="editShiftDate">Date</label>
                <input type="date" id="editShiftDate" name="Day" class="form-control" required />
            </div>
            <div class="form-group">
                <label for="editEmployeeId">Employee Name</label>
                <select id="editEmployeeId" name="EmployeeID" class="form-control" required>
                    <option value="">Select an employee</option>
                    @foreach (var employee in Model.Employees)
                    {
                        <option value="@employee.EmployeeID">@employee.EmployeeName</option>
                    }
                </select>
            </div>
            <div class="form-group">
                <label for="editShiftType">Shift</label>
                <select id="editShiftType" name="ShiftType" class="form-control" required onchange="updateEditShiftTimes()">
                    <option value="">Select shift</option>
                    <option value="AM">Morning Shift (10:30 AM to 6:30 PM)</option>
                    <option value="PM">Afternoon Shift (3:00 PM to 11:00 PM)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="editStartTime">Start Time</label>
                <input type="time" id="editStartTime" name="StartTime" class="form-control" required />
            </div>
            <div class="form-group">
                <label for="editEndTime">End Time</label>
                <input type="time" id="editEndTime" name="EndTime" class="form-control" required />
            </div>
            <button type="submit" class="btn btn-primary">Update</button>
            <button type="button" class="btn btn-danger" onclick="deleteShift()">Delete</button>
        </form>
    </div>
</div>

@section Scripts {
    <script src="~/js/timesheet.js"></script>

    <style>
        .day-box {
            position: relative;
            padding: 10px;
            border: 1px solid #ccc;
            margin: 5px;
            border-radius: 5px;
        }
        .plus-sign {
            position: absolute;
            top: 5px;
            right: 5px;
            cursor: pointer;
            display: none;
        }
        .day-box:hover .plus-sign {
            display: block;
        }
        th {
            text-align: center;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        li {
            cursor: pointer;
        }
        li:hover {
            background-color: #f0f0f0;
        }
    </style>
}